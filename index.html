<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì„ìƒì„¼í„° íŒ€ ì„±í–¥ ë¶„ì„~ - ì‚¬ì£¼ Ã— MBTI</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Gowun+Batang:wght@400;700&family=Hi+Melody&display=swap" rel="stylesheet">
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: 'Gowun Batang', 'Hi Melody', serif;
      background: linear-gradient(160deg, #fff5f7 0%, #fce8ec 30%, #f8e8f4 60%, #f0e6fa 100%);
      min-height: 100vh;
      color: #5a4a5a;
      padding: 2rem;
      line-height: 1.7;
      position: relative;
    }
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-image: radial-gradient(circle at 20% 30%, rgba(255, 182, 193, 0.15) 0%, transparent 50%),
                        radial-gradient(circle at 80% 70%, rgba(221, 160, 221, 0.12) 0%, transparent 50%);
      pointer-events: none;
      z-index: 0;
    }
    .container {
      max-width: 640px;
      margin: 0 auto;
      position: relative;
      z-index: 1;
    }
    h1 {
      text-align: center;
      margin-bottom: 2rem;
      font-size: 2rem;
      font-weight: 700;
      font-family: 'Hi Melody', cursive;
      color: #d4849c;
      text-shadow: 1px 1px 0 rgba(255,255,255,0.8);
    }
    h1::before { content: 'ğŸŒ¸ '; }
    h1::after { content: ' ğŸŒ¸'; }
    .card {
      background: rgba(255, 255, 255, 0.85);
      border: 2px solid rgba(255, 182, 193, 0.4);
      border-radius: 24px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      box-shadow: 0 4px 20px rgba(212, 132, 156, 0.12);
    }
    .form-row {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }
    .form-group {
      flex: 1;
      min-width: 140px;
    }
    label {
      display: block;
      font-size: 0.9rem;
      color: #8b7a8b;
      margin-bottom: 0.35rem;
    }
    input, select {
      width: 100%;
      padding: 0.65rem 0.9rem;
      border: 2px solid rgba(212, 132, 156, 0.3);
      border-radius: 16px;
      background: #fff;
      color: #5a4a5a;
      font-size: 0.95rem;
      font-family: inherit;
    }
    input:focus, select:focus {
      outline: none;
      border-color: #d4849c;
      box-shadow: 0 0 0 3px rgba(212, 132, 156, 0.15);
    }
    input::placeholder {
      color: #b8a8b8;
    }
    select option {
      background: #fff;
      color: #5a4a5a;
    }
    .mbti-row {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }
    .mbti-row select {
      flex: 1;
      min-width: 70px;
    }
    button {
      padding: 0.7rem 1.3rem;
      border: none;
      border-radius: 20px;
      font-size: 0.95rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.25s;
      font-family: inherit;
    }
    .btn-primary {
      background: linear-gradient(135deg, #f4a6b8, #e899b0);
      color: #fff;
      margin-right: 0.5rem;
      margin-bottom: 0.5rem;
      box-shadow: 0 3px 12px rgba(212, 132, 156, 0.35);
    }
    .btn-primary:hover {
      transform: translateY(-2px) scale(1.02);
      box-shadow: 0 6px 20px rgba(212, 132, 156, 0.45);
    }
    .btn-secondary {
      background: #fff;
      color: #c97a94;
      border: 2px solid rgba(212, 132, 156, 0.5);
    }
    .btn-secondary:hover {
      background: rgba(255, 182, 193, 0.25);
      border-color: #d4849c;
    }
    .result-box {
      background: linear-gradient(135deg, #fff9fb 0%, #fef5f8 100%);
      border: 2px dashed rgba(212, 132, 156, 0.35);
      border-radius: 20px;
      padding: 1.25rem;
      margin-top: 1rem;
      white-space: pre-line;
      min-height: 60px;
      color: #5a4a5a;
    }
    .team-names {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-top: 0.5rem;
    }
    .team-name-tag {
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      background: linear-gradient(135deg, #ffd6e0, #ffe4ec);
      color: #b85c7a;
      padding: 0.4rem 0.5rem 0.4rem 0.9rem;
      border-radius: 20px;
      font-size: 0.9rem;
      font-weight: 600;
      border: 1px solid rgba(212, 132, 156, 0.3);
      position: relative;
    }
    .tag-delete {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 1.1rem;
      height: 1.1rem;
      padding: 0;
      border: none;
      border-radius: 50%;
      background: rgba(184, 92, 122, 0.25);
      color: #b85c7a;
      font-size: 1rem;
      line-height: 1;
      cursor: pointer;
      transition: all 0.2s;
    }
    .tag-delete:hover {
      background: rgba(184, 92, 122, 0.45);
    }
    .api-key-hint {
      font-size: 0.8rem;
      color: #9a8a9a;
      margin-top: 0.5rem;
    }
    .loading {
      color: #b8a8b8;
      font-style: italic;
    }
    .error {
      color: #d4607a;
      font-size: 0.9rem;
    }
    .section-title {
      font-family: 'Hi Melody', cursive;
      font-size: 1.15rem;
      color: #c97a94;
      margin-bottom: 0.5rem;
    }
    .my-result-section {
      margin-bottom: 1.25rem;
    }
    .my-result-section:last-child {
      margin-bottom: 0;
    }
    .my-result-section-title {
      font-weight: 700;
      color: #b85c7a;
      margin-bottom: 0.5rem;
      font-size: 1rem;
    }
    .my-result-section-content {
      white-space: pre-line;
      line-height: 1.65;
      color: #5a4a5a;
    }
    .my-result-core-inner {
      display: flex;
      gap: 1rem;
      align-items: flex-start;
    }
    .ohang-illust {
      flex-shrink: 0;
      width: 180px;
      height: 180px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #ffd6e0 0%, #f4a6b8 50%, #e899b0 100%);
      border-radius: 50%;
      padding: 8%;
      box-shadow: 0 4px 16px rgba(212, 132, 156, 0.35);
      border: 3px solid rgba(255, 255, 255, 0.8);
      overflow: hidden;
    }
    .ohang-illust img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      object-position: center;
      display: block;
      max-width: 100%;
      max-height: 100%;
    }
    .ohang-illust .ohang-fallback {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3rem;
      font-weight: 700;
      color: rgba(184, 92, 122, 0.6);
      background: transparent;
    }
    .my-result-text {
      white-space: pre-line;
    }
    .team-comp-section-title {
      font-family: 'Hi Melody', cursive;
      font-size: 1.35rem;
      font-weight: 700;
      color: #c97a94;
      margin: 1.5rem 0 0.75rem;
      padding-bottom: 0.4rem;
      border-bottom: 2px solid rgba(212, 132, 156, 0.4);
    }
    .team-comp-section-title:first-child {
      margin-top: 0;
    }
    .team-comp-table-wrap {
      margin-bottom: 1rem;
      border-radius: 16px;
      white-space: normal;
      overflow-x: auto;
      box-shadow: 0 4px 20px rgba(212, 132, 156, 0.15);
      border: 1px solid rgba(212, 132, 156, 0.2);
    }
    .team-comp-table {
      width: 100%;
      min-width: 480px;
      border-collapse: collapse;
      font-size: 0.88rem;
      table-layout: fixed;
    }
    .team-comp-table col:nth-child(1) { width: 14%; }
    .team-comp-table col:nth-child(2) { width: 10%; }
    .team-comp-table col:nth-child(3) { width: 18%; }
    .team-comp-table col:nth-child(4) { width: 58%; }
    .team-comp-table th,
    .team-comp-table td {
      border-bottom: 1px solid rgba(212, 132, 156, 0.2);
      padding: 0.5rem 0.65rem;
      text-align: left;
      vertical-align: middle;
    }
    .team-comp-table th {
      background: linear-gradient(135deg, #d4849c, #c97a94);
      color: #fff;
      font-weight: 600;
      font-size: 0.85rem;
      letter-spacing: 0.02em;
    }
    .team-comp-table td {
      background: #fff;
      line-height: 1.45;
    }
    .team-comp-table td:first-child {
      font-weight: 600;
      color: #b85c7a;
    }
    .team-comp-table td:nth-child(2) {
      font-family: monospace;
      font-size: 0.85rem;
      color: #5a4a5a;
    }
    .team-comp-table td:nth-child(3) {
      color: #8b6b8b;
      font-weight: 500;
    }
    .team-comp-table td:nth-child(4) {
      word-break: break-word;
      overflow-wrap: break-word;
      color: #5a4a5a;
      line-height: 1.5;
    }
    .team-comp-table tbody tr {
      border-bottom: 1px solid rgba(212, 132, 156, 0.12);
    }
    .team-comp-table tbody tr:last-child {
      border-bottom: none;
    }
    .team-comp-table tbody tr:nth-child(even) td {
      background: #fffbfc;
    }
    .team-comp-table tbody tr:hover td {
      background: #fff5f8;
    }
    .team-comp-narrative {
      white-space: pre-line;
      line-height: 1.7;
    }
    .team-comp-narrative strong {
      color: #b85c7a;
    }
    .team-comp-content {
      white-space: normal;
      overflow: visible;
    }

    .button-with-ohang {
      display: flex;
      align-items: flex-start;
      gap: 1.5rem;
      flex-wrap: wrap;
    }
    .button-group {
      flex: 1;
      min-width: 200px;
    }
    .five-elements-wrap {
      flex-shrink: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.35rem;
    }
    .five-elements-img {
      width: 100px;
      height: auto;
      display: block;
      border-radius: 12px;
      box-shadow: 0 2px 12px rgba(212, 132, 156, 0.2);
      border: 2px solid rgba(212, 132, 156, 0.25);
    }
    .five-elements-caption {
      font-size: 0.8rem;
      color: #9a8a9a;
    }

    /* ëª¨ë°”ì¼ ëŒ€ì‘ */
    @media (max-width: 640px) {
      body { padding: 1rem; }
      h1 { font-size: 1.4rem; }
      .card { padding: 1rem; }
      /* ì˜¤í–‰ ì´ë¯¸ì§€: ëª¨ë°”ì¼ì—ì„œ í‘œì‹œ ë³´ì¥ */
      .my-result-core-inner {
        flex-direction: column;
        align-items: center;
      }
      .ohang-illust {
        width: 120px;
        height: 120px;
      }
      .ohang-illust img {
        max-width: 100%;
        max-height: 100%;
      }
      .button-with-ohang {
        flex-direction: column;
        align-items: center;
      }
      .five-elements-wrap {
        order: -1;
      }
      .five-elements-img {
        width: 80px;
      }
      /* íŒ€ ê¶í•© í‘œ: ëª¨ë°”ì¼ ì¹´ë“œí˜•ìœ¼ë¡œ ì „í™˜ */
      .team-comp-table-wrap {
        overflow-x: visible;
      }
      .team-comp-table {
        min-width: 100%;
        table-layout: auto;
        display: block;
      }
      .team-comp-table thead { display: none; }
      .team-comp-table tbody { display: block; }
      .team-comp-table tr {
        display: block;
        margin-bottom: 1rem;
        padding: 0.75rem;
        background: #fff;
        border-radius: 12px;
        border: 1px solid rgba(212, 132, 156, 0.25);
        box-shadow: 0 2px 8px rgba(212, 132, 156, 0.1);
      }
      .team-comp-table td {
        display: block;
        padding: 0.4rem 0;
        border: none;
        text-align: left;
      }
      .team-comp-table td::before {
        content: attr(data-label);
        display: block;
        font-size: 0.75rem;
        font-weight: 600;
        color: #c97a94;
        margin-bottom: 0.2rem;
      }
      .team-comp-table td:nth-child(1)::before { content: 'ì´ë¦„'; }
      .team-comp-table td:nth-child(2)::before { content: 'MBTI'; }
      .team-comp-table td:nth-child(3)::before { content: 'í•µì‹¬ì—­í• '; }
      .team-comp-table td:nth-child(4)::before { content: 'ì—…ë¬´ì‹œë„ˆì§€í¬ì¸íŠ¸'; }
      .team-comp-table td:first-child {
        font-size: 1rem;
        padding-top: 0;
      }
      .team-comp-table td:nth-child(4) {
        word-break: keep-all;
        overflow-wrap: break-word;
        line-height: 1.6;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ì„ìƒì„¼í„° íŒ€ ì„±í–¥ ë¶„ì„~ Â· ì‚¬ì£¼ Ã— MBTI</h1>

    <!-- ê¸°ë³¸ ì •ë³´ -->
    <div class="card">
      <h3 class="section-title" style="margin-bottom: 1rem;">ê¸°ë³¸ ì •ë³´</h3>
      <div class="form-row">
        <div class="form-group">
          <label>ì´ë¦„</label>
          <input type="text" id="userName" placeholder="í™ê¸¸ë™">
        </div>
        <div class="form-group">
          <label>íŒ€ëª…</label>
          <input type="text" id="teamName" placeholder="ì˜ˆ: ê°œë°œíŒ€">
        </div>
      </div>

      <!-- ì‚¬ì£¼: ìƒë…„ì›”ì¼ì‹œ -->
      <h4 style="margin: 1rem 0 0.5rem; font-size: 1rem; color: #8b7a8b;">ì‚¬ì£¼ ì •ë³´ <span style="font-size: 0.8rem; font-weight: normal; color: #9a8a9a;">(ì–‘ë ¥ìœ¼ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”)</span></h4>
      <div class="form-row">
        <div class="form-group">
          <label>ìƒë…„</label>
          <input type="number" id="birthYear" placeholder="1990" min="1900" max="2100">
        </div>
        <div class="form-group">
          <label>ìƒì›”</label>
          <input type="number" id="birthMonth" placeholder="1" min="1" max="12">
        </div>
        <div class="form-group">
          <label>ìƒì¼</label>
          <input type="number" id="birthDay" placeholder="15" min="1" max="31">
        </div>
        <div class="form-group">
          <label>íƒœì–´ë‚œ ì‹œê°„</label>
          <select id="birthHour">
            <option value="">ëª¨ë¦„</option>
            <option value="ìì‹œ">ìì‹œ (23:00~01:00)</option>
            <option value="ì¶•ì‹œ">ì¶•ì‹œ (01:00~03:00)</option>
            <option value="ì¸ì‹œ">ì¸ì‹œ (03:00~05:00)</option>
            <option value="ë¬˜ì‹œ">ë¬˜ì‹œ (05:00~07:00)</option>
            <option value="ì§„ì‹œ">ì§„ì‹œ (07:00~09:00)</option>
            <option value="ì‚¬ì‹œ">ì‚¬ì‹œ (09:00~11:00)</option>
            <option value="ì˜¤ì‹œ">ì˜¤ì‹œ (11:00~13:00)</option>
            <option value="ë¯¸ì‹œ">ë¯¸ì‹œ (13:00~15:00)</option>
            <option value="ì‹ ì‹œ">ì‹ ì‹œ (15:00~17:00)</option>
            <option value="ìœ ì‹œ">ìœ ì‹œ (17:00~19:00)</option>
            <option value="ìˆ ì‹œ">ìˆ ì‹œ (19:00~21:00)</option>
            <option value="í•´ì‹œ">í•´ì‹œ (21:00~23:00)</option>
          </select>
        </div>
      </div>

      <!-- MBTI -->
      <h4 style="margin: 1rem 0 0.5rem; font-size: 1rem; color: #8b7a8b;">MBTI</h4>
      <div class="mbti-row">
        <select id="mbti1">
          <option value="">ì„ íƒ</option>
          <option value="I">I</option>
          <option value="E">E</option>
        </select>
        <select id="mbti2">
          <option value="">ì„ íƒ</option>
          <option value="N">N</option>
          <option value="S">S</option>
        </select>
        <select id="mbti3">
          <option value="">ì„ íƒ</option>
          <option value="T">T</option>
          <option value="F">F</option>
        </select>
        <select id="mbti4">
          <option value="">ì„ íƒ</option>
          <option value="J">J</option>
          <option value="P">P</option>
        </select>
      </div>
    </div>

    <!-- ë²„íŠ¼ ì˜ì—­ + ìŒì–‘ì˜¤í–‰ ì•ˆë‚´ -->
    <div class="card">
      <div class="button-with-ohang">
        <div class="button-group">
          <div style="margin-bottom: 1rem;">
            <button type="button" class="btn-primary" id="btnMyResult">ë‚´ ê²°ê³¼ë³´ê¸°</button>
            <button type="button" class="btn-secondary" id="btnAccumulate">íŒ€ì›ê°’ìœ¼ë¡œ ë‚´ì •ë³´ ëˆ„ì í•˜ê¸°</button>
          </div>
          <button type="button" class="btn-primary" id="btnTeamCompatibility">ìš°ë¦¬ íŒ€ì˜ ì„±í–¥ ê¶í•©</button>
        </div>
        <div class="five-elements-wrap" title="ìŒì–‘ì˜¤í–‰">
          <img src="five_elements.png" alt="ìŒì–‘ì˜¤í–‰" class="five-elements-img">
          <span class="five-elements-caption">ìŒì–‘ì˜¤í–‰</span>
        </div>
      </div>
    </div>

    <!-- ë‚´ ê²°ê³¼ -->
    <div class="card">
      <h3 class="section-title" style="margin-bottom: 0.5rem;">ë‚´ ì„±í–¥ ê²°ê³¼</h3>
      <div id="myResult" class="result-box">ë‚´ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë¼ìš” ğŸ’•</div>
    </div>

    <!-- ëˆ„ì ëœ íŒ€ì› -->
    <div class="card">
      <h3 class="section-title" style="margin-bottom: 0.5rem;">ëˆ„ì ëœ íŒ€ì› ì´ë¦„</h3>
      <div id="accumulatedNames" class="team-names">ì•„ì§ ëˆ„ì ëœ íŒ€ì›ì´ ì—†ìŠµë‹ˆë‹¤.</div>
    </div>

    <!-- íŒ€ ê¶í•© ê²°ê³¼ -->
    <div class="card">
      <h3 class="section-title" style="margin-bottom: 0.5rem;">ìš°ë¦¬ íŒ€ì˜ ì„±í–¥ ê¶í•©</h3>
      <div id="teamCompatibility" class="result-box">íŒ€ì› ì •ë³´ë¥¼ ëˆ„ì í•œ í›„ 'ìš°ë¦¬ íŒ€ì˜ ì„±í–¥ ê¶í•©' ë²„íŠ¼ì„ ëˆŒëŸ¬ë³´ì„¸ìš” âœ¨</div>
    </div>

    <!-- API í‚¤ ì„¤ì • (ê°œë°œìš© - ì‹¤ì œ ë°°í¬ ì‹œ ì„œë²„ì—ì„œ ì²˜ë¦¬ ê¶Œì¥) -->
    <div class="card">
      <label>Gemini API í‚¤ <span style="color:#666">(í•„ìš” ì‹œ ì…ë ¥)</span></label>
      <input type="password" id="apiKey" placeholder="API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì„ íƒ)">
      <p class="api-key-hint">Google AI Studio(aistudio.google.com)ì—ì„œ ë¬´ë£Œ API í‚¤ ë°œê¸‰ ê°€ëŠ¥. ë¸Œë¼ìš°ì €ì— ë…¸ì¶œë˜ë¯€ë¡œ ë¡œì»¬/ê°œë°œìš©ìœ¼ë¡œë§Œ ì‚¬ìš©í•˜ì„¸ìš”.</p>
    </div>
  </div>

  <script>
    // localStorage í‚¤
    const STORAGE_KEY = 'team_members_data';

    // ì˜¤í–‰ë³„ ì´ë¯¸ì§€ (ëª©/í™”/í† /ê¸ˆ/ìˆ˜) - ìˆ˜:Water, í™”:Fire, ëª©:Wood, ê¸ˆ:Metal, í† :Earth(Eearth)
    const OHANG_IMAGES = { ìˆ˜: 'ë¬¼.png', í™”: 'ë¶ˆ.png', ëª©: 'ë‚˜ë¬´.png', ê¸ˆ: 'ê¸ˆ.png', í† : 'í™.png' };
    const OHANG_EMOJI = { ìˆ˜: 'ğŸ’§', í™”: 'ğŸ”¥', ëª©: 'ğŸŒ³', ê¸ˆ: 'âš™ï¸', í† : 'ğŸŒ' };

    // MBTI ê°’ ìˆ˜ì§‘
    function getMBTI() {
      const m1 = document.getElementById('mbti1').value;
      const m2 = document.getElementById('mbti2').value;
      const m3 = document.getElementById('mbti3').value;
      const m4 = document.getElementById('mbti4').value;
      if (!m1 || !m2 || !m3 || !m4) return null;
      return m1 + m2 + m3 + m4;
    }

    // ì‚¬ì£¼ ì •ë³´ ìˆ˜ì§‘
    function getSajuInfo() {
      const year = document.getElementById('birthYear').value;
      const month = document.getElementById('birthMonth').value;
      const day = document.getElementById('birthDay').value;
      const hour = document.getElementById('birthHour').value;
      return { year, month, day, hour };
    }

    // ë§Œì„¸ë ¥: @fullstackfamily/manseryeokë¡œ ì¼ê°„(æ—¥å¹²) ì‚°ì¶œ â†’ ì˜¤í–‰ (ëª©/í™”/í† /ê¸ˆ/ìˆ˜)
    const STEM_TO_OHANG = { 'ê°‘':'ëª©','ì„':'ëª©','ë³‘':'í™”','ì •':'í™”','ë¬´':'í† ','ê¸°':'í† ','ê²½':'ê¸ˆ','ì‹ ':'ê¸ˆ','ì„':'ìˆ˜','ê³„':'ìˆ˜' };
    const STEM_TO_ILGAN_NAME = { 'ê°‘':'ê°‘ëª©(ç”²æœ¨)','ì„':'ì„ëª©(ä¹™æœ¨)','ë³‘':'ë³‘í™”(ä¸™ç«)','ì •':'ì •í™”(ä¸ç«)','ë¬´':'ë¬´í† (æˆŠåœŸ)','ê¸°':'ê¸°í† (å·±åœŸ)','ê²½':'ê²½ê¸ˆ(åºšé‡‘)','ì‹ ':'ì‹ ê¸ˆ(è¾›é‡‘)','ì„':'ì„ìˆ˜(å£¬æ°´)','ê³„':'ê³„ìˆ˜(ç™¸æ°´)' };
    const ILGAN_TRAIT_HINT = { 'ê³„':'ìœ ì—°í•¨, ì§€í˜œ, ì •ë°€í•¨', 'ì„':'í¬ìš©ë ¥, íë¦„ ì½ê¸°', 'ê°‘':'ë¦¬ë”ì‹­, ë„ì „ì •ì‹ ', 'ì„':'ì„¬ì„¸í•¨, ì ì‘ë ¥', 'ë³‘':'ì—´ì •, ì¹´ë¦¬ìŠ¤ë§ˆ', 'ì •':'ì„¬ì„¸í•œ í†µì°°', 'ë¬´':'ì•ˆì •, ì‹ ë¢°', 'ê¸°':'ë°°ë ¤, ì¡°í™”', 'ê²½':'ê²°ë‹¨, ì •ì˜ê°', 'ì‹ ':'ì˜ˆë¦¬í•¨, ì™„ì„±ë„' };
    const HOUR_MAP = { 'ìì‹œ':0,'ì¶•ì‹œ':2,'ì¸ì‹œ':4,'ë¬˜ì‹œ':6,'ì§„ì‹œ':8,'ì‚¬ì‹œ':10,'ì˜¤ì‹œ':12,'ë¯¸ì‹œ':14,'ì‹ ì‹œ':16,'ìœ ì‹œ':18,'ìˆ ì‹œ':20,'í•´ì‹œ':22 };

    let _manseryeok = null;
    async function getIlganOhang(year, month, day, hourStr) {
      const y = parseInt(year, 10), m = parseInt(month, 10), d = parseInt(day, 10);
      if (isNaN(y) || isNaN(m) || isNaN(d) || m < 1 || m > 12 || d < 1 || d > 31) return { ohang: null, stem: null, ilganName: null };
      try {
        if (!_manseryeok) _manseryeok = await import('https://unpkg.com/@fullstackfamily/manseryeok@1.0.5/dist/index.esm.js');
        const h = hourStr && HOUR_MAP[hourStr] !== undefined ? HOUR_MAP[hourStr] : 12;
        const saju = _manseryeok.calculateSaju(y, m, d, h, 30);
        const dayStem = (saju.dayPillar || '').charAt(0);
        const ohang = STEM_TO_OHANG[dayStem] || null;
        const ilganName = STEM_TO_ILGAN_NAME[dayStem] || null;
        return { ohang, stem: dayStem, ilganName };
      } catch (e) {
        return { ohang: null, stem: null, ilganName: null };
      }
    }

    // Gemini API í˜¸ì¶œ (temperature: ë‚®ì„ìˆ˜ë¡ ì¼ê´€ëœ ê²°ê³¼)
    async function callGemini(prompt, options = {}) {
      const apiKey = document.getElementById('apiKey').value?.trim();
      if (!apiKey) {
        throw new Error('Gemini API í‚¤ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”. (Google AI Studioì—ì„œ ë°œê¸‰ ê°€ëŠ¥)');
      }
      const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
      const res = await fetch(url, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          contents: [{
            parts: [{ text: prompt }]
          }],
          generationConfig: {
            temperature: options.temperature !== undefined ? options.temperature : 0.8,
            maxOutputTokens: 2048,
          }
        })
      });
      if (!res.ok) {
        const err = await res.json();
        throw new Error(err.error?.message || 'API í˜¸ì¶œ ì‹¤íŒ¨');
      }
      const data = await res.json();
      return data.candidates?.[0]?.content?.parts?.[0]?.text?.trim() || 'ì‘ë‹µì„ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
    }

    // ë‚´ ê²°ê³¼ë³´ê¸°
    document.getElementById('btnMyResult').addEventListener('click', async () => {
      const box = document.getElementById('myResult');
      const mbti = getMBTI();
      const saju = getSajuInfo();

      if (!mbti) {
        box.innerHTML = '<span class="error">MBTI 4ê°€ì§€ ì„±í–¥ì„ ëª¨ë‘ ì„ íƒí•´ ì£¼ì„¸ìš”.</span>';
        return;
      }
      if (!saju.year || !saju.month || !saju.day) {
        box.innerHTML = '<span class="error">ìƒë…„, ìƒì›”, ìƒì¼ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.</span>';
        return;
      }

      box.innerHTML = '<span class="loading">âœ¨ ì„±í–¥ì„ ë¶„ì„í•˜ê³  ìˆì–´ìš”... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”</span>';

      const userName = document.getElementById('userName').value?.trim() || 'ì´ ì‚¬ëŒ';
      const hourText = saju.hour ? `${saju.hour}` : 'ëª¨ë¦„';

      const { ohang, ilganName, stem } = await getIlganOhang(saju.year, saju.month, saju.day, saju.hour || null);
      const ohangVal = ohang || 'ìˆ˜';
      const ilganDesc = ilganName || `${ohangVal}í–‰`;
      const traitHint = (stem && ILGAN_TRAIT_HINT[stem]) ? ` (ì¼ê°„ ${ilganDesc}ì˜ íŠ¹ì„±: ${ILGAN_TRAIT_HINT[stem]}ì„ ê°•ì¡°í•˜ì„¸ìš”)` : '';

      try {
        const prompt = `ë‹¹ì‹ ì€ ì‚¬ì£¼íŒ”ìì™€ MBTIë¥¼ ëª¨ë‘ ì˜ ì•„ëŠ” ì „ë¬¸ê°€ì…ë‹ˆë‹¤.
${userName}ë‹˜ì˜ ì‚¬ì£¼ì™€ MBTIë¥¼ "ì—…ë¬´(ì§ì¥/í˜‘ì—…)"ì™€ ì—°ê²°í•´ ì•„ë˜ í˜•ì‹ëŒ€ë¡œ ì‘ì„±í•´ ì£¼ì„¸ìš”.

ã€ì¤‘ìš”ã€‘ì´ ì‚¬ëŒì˜ ì¼ê°„(æ—¥å¹²)ì€ "${ilganDesc}"ì…ë‹ˆë‹¤. ì‚¬ì£¼ì—ì„œ 'ë‚˜'ëŠ” ë°˜ë“œì‹œ ì¼ê°„(íƒœì–´ë‚œ ë‚ ì˜ ì²œê°„)ì´ë©°, ë…„Â·ì›”Â·ì‹œì£¼ê°€ ì•„ë‹Œ ì¼ê°„ ê¸°ì¤€ì…ë‹ˆë‹¤. ì˜¤í–‰ì€ "${ohangVal}"ì…ë‹ˆë‹¤.${traitHint}

ã€ë°˜ë“œì‹œ ì•„ë˜ í˜•ì‹ê³¼ êµ¬ë¶„ì(ã€ã€‘)ë¥¼ ì •í™•íˆ ì‚¬ìš©í•˜ì„¸ìš”ã€‘

ã€1. í•µì‹¬ ê¸°ìš´ã€‘
- ì˜ˆ: ğŸ”¥ í•µì‹¬ ê¸°ìš´: "êº¼ì§€ì§€ ì•ŠëŠ” ì§€í˜œì˜ ë“±ë¶ˆ, ì •í™”(ä¸ç«)"
- ì¼ê°„(íƒœì–´ë‚œ ë‚ ì˜ ì²œê°„) ${ilganDesc}ë¥¼ ìì—°ë¬¼ì— ë¹„ìœ í•œ ì œëª©ê³¼ í•¨ê»˜ ì„¤ëª…
- ì´ì–´ì„œ ì‚¬ì£¼ì—ì„œ í•´ë‹¹ ì˜¤í–‰ì´ ì–´ë–»ê²Œ ë“œëŸ¬ë‚˜ëŠ”ì§€ 2~3ë¬¸ì¥ìœ¼ë¡œ ì„¤ëª…
- ë§ˆì§€ë§‰ì— "ì—…ë¬´ì  ì˜ë¯¸:"ë¡œ ì‹œì‘í•´, ì´ ê¸°ìš´ì´ ì§ì¥ì—ì„œ ì–´ë–»ê²Œ ë°œíœ˜ë˜ëŠ”ì§€ 1~2ë¬¸ì¥

ã€2. ê°•ì ã€‘
- [ì„±í–¥] MBTIì™€ ì˜¤í–‰ì´ ë§Œë‚¬ì„ ë•Œì˜ ì„±ê²©Â·ì‚¬ê³ ë°©ì‹ (í•œ ì¤„ ìš”ì•½ í¬í•¨)
- [ê°•ì ] ì—…ë¬´ì—ì„œ ë¹›ë‚˜ëŠ” ê°•ì  (í•œ ì¤„ ìš”ì•½ í¬í•¨)
- [ì—…ë¬´ ìŠ¤íƒ€ì¼] ì¼í•˜ëŠ” ë°©ì‹, í˜‘ì—… ìŠ¤íƒ€ì¼ (í•œ ì¤„ ìš”ì•½ í¬í•¨)
ì˜ˆì œì²˜ëŸ¼ "í•œ ì¤„ ìš”ì•½:" í˜•ì‹ìœ¼ë¡œ ê°ê° ë§ˆë¬´ë¦¬

ã€3. íŒ€ ë‚´ í•„ì‚´ê¸°ã€‘
- íŒ€ì—ì„œ ì´ ì‚¬ëŒì´ ë°œíœ˜í•  ìˆ˜ ìˆëŠ” íŠ¹ë³„í•œ ëŠ¥ë ¥ 2~3ê°€ì§€ë¥¼ bulletìœ¼ë¡œ
- ê° í•­ëª©ì€ í•œ ë¬¸ì¥ìœ¼ë¡œ ê°„ê²°í•˜ê²Œ

- ìƒë…„ì›”ì¼(ì–‘ë ¥): ${saju.year}ë…„ ${saju.month}ì›” ${saju.day}ì¼, íƒœì–´ë‚œ ì‹œê°„: ${hourText}
- MBTI: ${mbti}`;

        const rawResult = await callGemini(prompt, { temperature: 0.7 });
        let text = rawResult.replace(/\s*ã€ê°€ì¥ ê°•í•œ ì˜¤í–‰: (ëª©|í™”|í† |ê¸ˆ|ìˆ˜)ã€‘\s*/g, '').trim();
        const toHtml = (s) => s.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>').replace(/\n/g, '<br>');
        const sect1 = text.match(/ã€1\.\s*í•µì‹¬\s*ê¸°ìš´ã€‘\s*([\s\S]*?)(?=ã€2\.|$)/i);
        const sect2 = text.match(/ã€2\.\s*ê°•ì ã€‘\s*([\s\S]*?)(?=ã€3\.|$)/i);
        const sect3 = text.match(/ã€3\.\s*íŒ€\s*ë‚´\s*í•„ì‚´ê¸°ã€‘\s*([\s\S]*?)$/i);
        const c1 = sect1 ? sect1[1].trim() : '';
        const c2 = sect2 ? sect2[1].trim() : '';
        const c3 = sect3 ? sect3[1].trim() : '';
        const illustHtml = ohang ? `<div class="ohang-illust"><img src="${OHANG_IMAGES[ohang]}" alt="${ohang}" onerror="this.style.display='none';var s=this.nextElementSibling;s.style.display='flex';s.textContent='${OHANG_EMOJI[ohang]||ohang}'"><span class="ohang-fallback" style="display:none"></span></div>` : '';
        const html1 = c1 ? `<div class="my-result-section"><div class="my-result-section-title">ğŸ”¥ 1. í•µì‹¬ ê¸°ìš´</div><div class="my-result-core-inner">${illustHtml}<div class="my-result-section-content">${toHtml(c1)}</div></div></div>` : '';
        const html2 = c2 ? `<div class="my-result-section"><div class="my-result-section-title">ğŸ§ª 2. ê°•ì </div><div class="my-result-section-content">${toHtml(c2)}</div></div>` : '';
        const html3 = c3 ? `<div class="my-result-section"><div class="my-result-section-title">ğŸ’¡ 3. íŒ€ ë‚´ í•„ì‚´ê¸°</div><div class="my-result-section-content">${toHtml(c3)}</div></div>` : '';
        box.innerHTML = (html1 || html2 || html3) ? html1 + html2 + html3 : `<div class="my-result-text">${toHtml(text)}</div>`;
      } catch (e) {
        box.innerHTML = `<span class="error">ì˜¤ë¥˜: ${e.message}</span>`;
      }
    });

    // íŒ€ì› ì •ë³´ ëˆ„ì 
    document.getElementById('btnAccumulate').addEventListener('click', () => {
      const name = document.getElementById('userName').value?.trim();
      const team = document.getElementById('teamName').value?.trim();
      const mbti = getMBTI();
      const saju = getSajuInfo();

      if (!name) {
        alert('ì´ë¦„ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
        return;
      }
      if (!team) {
        alert('íŒ€ëª…ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
        return;
      }
      if (!mbti) {
        alert('MBTI 4ê°€ì§€ ì„±í–¥ì„ ëª¨ë‘ ì„ íƒí•´ ì£¼ì„¸ìš”.');
        return;
      }
      if (!saju.year || !saju.month || !saju.day) {
        alert('ìƒë…„, ìƒì›”, ìƒì¼ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
        return;
      }

      let list = [];
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (raw) list = JSON.parse(raw);
      } catch (e) {
        list = [];
      }

      const key = `${team}::${name}`;
      const idx = list.findIndex(x => x.key === key);
      const entry = {
        key,
        name,
        team,
        mbti,
        saju,
        addedAt: new Date().toISOString()
      };
      if (idx >= 0) list[idx] = entry;
      else list.push(entry);

      localStorage.setItem(STORAGE_KEY, JSON.stringify(list));

      updateAccumulatedNames(team);
      alert(`"${name}"ë‹˜ì˜ ì •ë³´ê°€ ëˆ„ì ë˜ì—ˆìŠµë‹ˆë‹¤.`);
    });

    function updateAccumulatedNames(teamFilter) {
      const container = document.getElementById('accumulatedNames');
      let list = [];
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (raw) list = JSON.parse(raw);
      } catch (e) {}
      if (teamFilter) {
        list = list.filter(x => x.team === teamFilter);
      }
      if (list.length === 0) {
        container.innerHTML = teamFilter
          ? `"${teamFilter}" íŒ€ì—ëŠ” ì•„ì§ ëˆ„ì ëœ íŒ€ì›ì´ ì—†ì–´ìš”`
          : 'ì•„ì§ ëˆ„ì ëœ íŒ€ì›ì´ ì—†ì–´ìš”';
        return;
      }
      container.innerHTML = list.map(x => `<span class="team-name-tag">${x.name}<button type="button" class="tag-delete" data-key="${x.key}" title="ì‚­ì œ">Ã—</button></span>`).join('');
    }

    // ë§ˆí¬ë‹¤ìš´ í‘œë¥¼ HTMLë¡œ ë³€í™˜, ì„¹ì…˜ ì œëª© ë° ë³¼ë“œ ì²˜ë¦¬
    function parseTeamResult(text, teamName) {
      const teamLabel = teamName ? teamName : 'íŒ€';
      text = text.replace(/\s*\[?1ë‹¨ê³„\]?\s*ìš”ì•½í‘œ\s*/g, '');
      const lines = text.split('\n');
      const tableLines = [];
      let i = 0;
      while (i < lines.length && lines[i].includes('|')) {
        const line = lines[i];
        if (/[ê°€-í£a-zA-Z0-9]/.test(line) && !/^\|?\s*\[?1ë‹¨ê³„\]?\s*ìš”ì•½í‘œ\s*\|?/.test(line.trim())) tableLines.push(line);
        i++;
      }
      let tableHtml = '';
      if (tableLines.length >= 1) {
        const headerCells = tableLines[0].split('|').filter(c => c.trim());
        const colCount = Math.max(headerCells.length, 4);
        const colgroup = '<colgroup>' + Array(colCount).fill('<col>').join('') + '</colgroup>';
        const headerRow = '<tr>' + headerCells.map(c => `<th>${c.trim()}</th>`).join('') + '</tr>';
        let bodyRows = '';
        for (let j = 1; j < tableLines.length; j++) {
          const cells = tableLines[j].split('|').filter(c => c.trim());
          if (cells.length >= 1) bodyRows += '<tr>' + cells.map(c => `<td>${c.trim()}</td>`).join('') + '</tr>';
        }
        tableHtml = `<div class="team-comp-table-wrap"><table class="team-comp-table">${colgroup}<thead>${headerRow}</thead><tbody>${bodyRows}</tbody></table></div>`;
      }
      const narrativeStart = lines.findIndex((l, idx) => idx >= i && l.trim().length > 0);
      let narrative = narrativeStart >= 0 ? lines.slice(narrativeStart).join('\n').trim() : '';
      narrative = narrative.replace(/^ì•Œê² ìŠµë‹ˆë‹¤\.?[\s\S]*?(?:ì œê³µ|ì‘ì„±|ì •ë¦¬|ë¶„ì„)í•´\s*ë“œë¦¬ê² ìŠµë‹ˆë‹¤\.?\s*/i, '');
      narrative = narrative.replace(/^(?:ë„¤,?|ì¢‹ìŠµë‹ˆë‹¤\.?)\s*[\s\S]*?ë“œë¦¬ê² ìŠµë‹ˆë‹¤\.?\s*/i, '');
      narrative = narrative.replace(/^ìš°ë¦¬íŒ€ì˜\s*ê¸ì •\s*ì‹œë„ˆì§€\s*ê·¸ë£¹\s*[:\s]*/i, '');
      narrative = narrative.trim();
      const boldNarrative = narrative.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
      const narrativeHtml = boldNarrative ? `<div class="team-comp-narrative">${boldNarrative.replace(/\n/g, '<br>')}</div>` : '';
      const section1 = `<div class="team-comp-content"><h3 class="team-comp-section-title">1. ${teamLabel} ë‚´ ë§ì¶¤ ì—­í•  (Role-Play)</h3>${tableHtml}`;
      const section2 = narrativeHtml ? `<h3 class="team-comp-section-title">2. ìš°ë¦¬íŒ€ì˜ ê¸ì • ì‹œë„ˆì§€ ê·¸ë£¹</h3>${narrativeHtml}` : '';
      return section1 + section2 + '</div>';
    }

    // íŒ€ ê¶í•© ë³´ê¸°
    document.getElementById('btnTeamCompatibility').addEventListener('click', async () => {
      const box = document.getElementById('teamCompatibility');
      const team = document.getElementById('teamName').value?.trim();

      let list = [];
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (raw) list = JSON.parse(raw);
      } catch (e) {}

      if (team) list = list.filter(x => x.team === team);
      if (list.length < 2) {
        box.innerHTML = '<span class="error">íŒ€ ê¶í•©ì„ ë³´ë ¤ë©´ ê°™ì€ íŒ€ì›ì´ 2ëª… ì´ìƒ ëˆ„ì ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤. íŒ€ëª…ì„ ì…ë ¥í•˜ê³  íŒ€ì› ì •ë³´ë¥¼ ëˆ„ì í•´ ì£¼ì„¸ìš”.</span>';
        return;
      }

      box.innerHTML = '<span class="loading">âœ¨ íŒ€ ê¶í•©ì„ ë¶„ì„í•˜ê³  ìˆì–´ìš”... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”</span>';

      const membersDesc = list.map((m, i) => {
        const h = m.saju.hour ? m.saju.hour : 'ëª¨ë¦„';
        return `${i + 1}. ${m.name}: ì‚¬ì£¼(ì–‘ë ¥) ${m.saju.year}ë…„ ${m.saju.month}ì›” ${m.saju.day}ì¼ ${h}, MBTI ${m.mbti}`;
      }).join('\n');

      const prompt = `ë‹¹ì‹ ì€ ì‚¬ì£¼íŒ”ìì™€ MBTIë¥¼ ëª¨ë‘ ì˜ ì•„ëŠ” íŒ€ ë¹Œë”© ì „ë¬¸ê°€ì…ë‹ˆë‹¤.
â€» íŒ€ì›ë“¤ì˜ ìƒë…„ì›”ì¼ì€ ëª¨ë‘ ì–‘ë ¥(íƒœì–‘ë ¥) ê¸°ì¤€ì…ë‹ˆë‹¤. ì–‘ë ¥ ê¸°ì¤€ìœ¼ë¡œ ì‚¬ì£¼ë¥¼ í•´ì„í•´ ì£¼ì„¸ìš”.

ë‹¤ìŒ íŒ€ì›ë“¤ì˜ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ, ë°˜ë“œì‹œ ì•„ë˜ ìˆœì„œì™€ í˜•ì‹ìœ¼ë¡œ ì‘ì„±í•´ ì£¼ì„¸ìš”.

ã€1ë‹¨ê³„ã€‘ê°€ì¥ ë¨¼ì € ìš”ì•½ í‘œë¥¼ ì‘ì„±í•˜ì„¸ìš”.
- ë°˜ë“œì‹œ ë§ˆí¬ë‹¤ìš´ í‘œ í˜•ì‹( | ë¡œ êµ¬ë¶„). ì»¬ëŸ¼: ì´ë¦„ | MBTI | í•µì‹¬ì—­í•  | ì—…ë¬´ì‹œë„ˆì§€í¬ì¸íŠ¸
- í•µì‹¬ì—­í• : ìºë¦­í„°ì²˜ëŸ¼ í•œ ë‹¨ì–´~ë‘ ë‹¨ì–´ë¡œ í‘œí˜„ (ì˜ˆ: ì•¼ì „ ì‚¬ë ¹ê´€, ì•„ì´ë””ì–´ íë ˆì´í„°)
- ì—…ë¬´ì‹œë„ˆì§€í¬ì¸íŠ¸: ê·¸ ì—­í• ì—ì„œ ë¹›ë‚˜ëŠ” ê°•ì ì„ í•œ ë¬¸ì¥ìœ¼ë¡œ. ì˜ˆ: "ê²°ì •ì ì¸ ìˆœê°„ì— ë¦¬ìŠ¤í¬ë¥¼ ê°ìˆ˜í•˜ê³  ë°©í–¥ì„ ê²°ì •í•˜ëŠ” ê²°ë‹¨ë ¥."

ì˜ˆì‹œ:
| ì´ë¦„ | MBTI | í•µì‹¬ì—­í•  | ì—…ë¬´ì‹œë„ˆì§€í¬ì¸íŠ¸ |
|------|------|----------|------------------|
| ë°•íŒ€ì¥ | ENTJ | ì•¼ì „ ì‚¬ë ¹ê´€ | ê²°ì •ì ì¸ ìˆœê°„ì— ë¦¬ìŠ¤í¬ë¥¼ ê°ìˆ˜í•˜ê³  ë°©í–¥ì„ ê²°ì •í•˜ëŠ” ê²°ë‹¨ë ¥. |
| ê¹€ëŒ€ë¦¬ | ISFJ | ì•ˆì • ìˆ˜í˜¸ì | ê¼¼ê¼¼í•˜ê²Œ ë””í…Œì¼ì„ ì±™ê²¨ íŒ€ì˜ ì‹¤ìˆ˜ë¥¼ ë¯¸ë¦¬ ë§‰ëŠ” ì‹ ë¢°ê°. |

ã€2ë‹¨ê³„ã€‘í‘œ ë‹¤ìŒì— ë¹ˆ ì¤„ ë‘” ë’¤, ê¸ì • ì‹œë„ˆì§€ ê·¸ë£¹ ë‚´ìš©ì„ ì„œìˆ í•˜ì„¸ìš”. ("ìš°ë¦¬íŒ€ì˜ ê¸ì • ì‹œë„ˆì§€ ê·¸ë£¹"ì´ë¼ëŠ” ì œëª©/í—¤ë”©ì€ ì“°ì§€ ë§ê³ , ë°”ë¡œ **ê·¸ë£¹ëª…:** í˜•íƒœë¶€í„° ì‹œì‘)
- MBTIÂ·ì‚¬ì£¼ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë¹„ìŠ·í•œ ì„±í–¥ì˜ íŒ€ì›ë“¤ì„ ê·¸ë£¹ìœ¼ë¡œ ë¬¶ê³ , ê° ê·¸ë£¹ì„ 2~4ì¤„ë¡œ ì„¤ëª….
- ê° ì†Œê·¸ë£¹ ì œëª©ì€ ë°˜ë“œì‹œ **ë³¼ë“œ** ì²˜ë¦¬. ì˜ˆ: **ì§ê´€í˜• ë¦¬ë” ê·¸ë£¹:** ê¹€ì² ìˆ˜, ì´ì˜í¬ ...
- ê¸ì •ì ì¸ ì¡°í•©(ì‹œë„ˆì§€)ë„ í¬í•¨.
- "ì•Œê² ìŠµë‹ˆë‹¤", "íŒ€ì› ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ~ ì œê³µí•´ ë“œë¦¬ê² ìŠµë‹ˆë‹¤", "ìš°ë¦¬íŒ€ì˜ ê¸ì • ì‹œë„ˆì§€ ê·¸ë£¹" ê°™ì€ ì¸ì‚¬ë§/ì œëª©ì€ ì“°ì§€ ë§ê³ , ë°”ë¡œ **ê·¸ë£¹ëª…:** ë¶€í„° ë³¸ë¬¸ë§Œ ì‘ì„±í•˜ì„¸ìš”.

ã€í‘œì—ã€‘[1ë‹¨ê³„]ìš”ì•½í‘œ ê°™ì€ í‘œ ì œëª©ì€ ë„£ì§€ ë§ˆì„¸ìš”. í‘œëŠ” | ì´ë¦„ | MBTI | í•µì‹¬ì—­í•  | ì—…ë¬´ì‹œë„ˆì§€í¬ì¸íŠ¸ | í–‰ë¶€í„° ë°”ë¡œ ì‹œì‘í•˜ê³ , ê·¸ ë‹¤ìŒ |---|---| êµ¬ë¶„í–‰, ê·¸ ë‹¤ìŒ ë°ì´í„° í–‰ ìˆœìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”. ê° ì…€ì€ í•œ ì¤„ë¡œ ê°„ê²°í•˜ê²Œ.

íŒ€ì› ì •ë³´:
${membersDesc}`;

      try {
        const rawResult = await callGemini(prompt);
        const parsed = parseTeamResult(rawResult, team || 'ìš°ë¦¬ íŒ€');
        box.innerHTML = parsed;
      } catch (e) {
        box.innerHTML = `<span class="error">ì˜¤ë¥˜: ${e.message}</span>`;
      }
    });

    // íŒ€ëª… ë³€ê²½ ì‹œ ëˆ„ì  íŒ€ì› ëª©ë¡ ê°±ì‹ 
    document.getElementById('teamName').addEventListener('blur', () => {
      const team = document.getElementById('teamName').value?.trim();
      updateAccumulatedNames(team);
    });

    // ëˆ„ì  íŒ€ì› ì‚­ì œ (x ë²„íŠ¼)
    document.getElementById('accumulatedNames').addEventListener('click', (e) => {
      const btn = e.target.closest('.tag-delete');
      if (!btn) return;
      const key = btn.getAttribute('data-key');
      if (!key) return;
      let list = [];
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (raw) list = JSON.parse(raw);
      } catch (err) {}
      list = list.filter(x => x.key !== key);
      localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
      const team = document.getElementById('teamName').value?.trim();
      updateAccumulatedNames(team);
    });

    // ì´ˆê¸° ë¡œë“œ ì‹œ (íŒ€ëª… ì—†ìœ¼ë©´ ì „ì²´ í‘œì‹œ)
    updateAccumulatedNames();
  </script>
</body>
</html>
